function sticksCreate(A){function F(b){var d=new Image;d.onload=function(){var c=d.width,a=d.height,e=document.createElement("canvas");e.width=c;e.height=a;var C=new THREE.Texture(e),g=e.getContext("2d"),q=new THREE.Sprite(new THREE.SpriteMaterial({opacity:b.opacity,map:C}));q.updateInfo=function(e){g.drawImage(d,0,a*TYPES[e.userData.typeIndex].bgOffsetV,c,a/2,0,0,c,a/2);b.drawCallback&&b.drawCallback(g,e.userData);C.needsUpdate=!0;e=e.localToWorld(e.geometry.vertices[1].clone());this.position.copy(e);
this.scale.copy(q.scale0).multiplyScalar(f.position.distanceTo(e)*b.fixedScaleFactor)};q.scale.set(c/a*b.size,b.size,.1);q.scale0=q.scale.clone();q.visible=!1;b.finishCallback&&b.finishCallback(q)};d.src=b.imageUrl}var x=!1,D,f,n,E,g,k=0,b=0,y=0,s=window.innerWidth/2,v,d,w,z,c;(function(){function G(){s=window.innerWidth/2;f.aspect=window.innerWidth/window.innerHeight;f.updateProjectionMatrix();g.setSize(window.innerWidth,window.innerHeight)}function H(a){k=a.clientX-s;if(x){if("undefined"===typeof a.offsetX||
"undefined"===typeof a.offsetY){var e=$(a.target).offset();a.offsetX=a.pageX-e.left;a.offsetY=a.pageY-e.top}a=new THREE.Vector3(a.offsetX/window.innerWidth*2-1,2*-(a.offsetY/window.innerHeight)+1,.5);E.unprojectVector(a,f);a=(new THREE.Raycaster(f.position,a.sub(f.position).normalize())).intersectObjects(w.children);var b;0<a.length&&(b=a[0].object);b!=c&&(b&&(b.material=b.selectedMaterial),c&&(c.material=c.normalMaterial),c=b,v&&(v.visible=void 0!=c,c&&v.updateInfo(c)),g.render(n,f))}}function B(){requestAnimationFrame(B);
!x&&.1<100-d.value&&(d.value+=1,.1>Math.abs(100-d.value)&&(d.value=100,x=!0));if(0<Math.abs(k)-.1*s){var a=0==k?0:0<k?1:-1,e=(Math.abs(k)-.1*s)/(.9*s);y=a*e*e*e*10}else y=0;b+=y;b*=.95;.01>Math.abs(b)?b=0:1500<Math.abs(b)&&(b=1500*(0==b?0:0<b?1:-1));a=f.position.x+b;0>a?a=0:a>z&&(a=z);f.position.x+=.1*(a-f.position.x);g.render(n,f)}$.ajax({url:"shader/vertex.glessl",type:"GET",async:!0,cache:!1,dataType:"text",success:function(a){$.ajax({url:"shader/fragment.glessl",type:"GET",async:!0,cache:!1,dataType:"text",
success:function(b){(function(){D=document.getElementById("container");E=new THREE.Projector;g=new THREE.WebGLRenderer({alpha:!0,antialias:!0});g.setClearColor(0,0);g.setSize(window.innerWidth,window.innerHeight);D.appendChild(g.domElement);n=new THREE.Scene;f=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,.5,3E6);F({imageUrl:"image/sticks-infobox.png?"+(new Date).getTime(),opacity:.86,size:15,fixedScaleFactor:.015,finishCallback:function(a){v=a;n.add(v)},drawCallback:function(a,
b){a.fillStyle=TYPES[b.typeIndex].color;a.textBaseline="top";a.font="30px 'Porsche News Gothic','\u9ed1\u4f53','sans-serif'";a.fillText("P"+b.rankings+"/"+Math.round(b.teamSize),21,16);a.font="19.65px 'Porsche News Gothic','\u9ed1\u4f53','sans-serif'";a.fillText(b.team,23,60);a.fillText(""+Math.round(b.speed)+"km/h",132,60);a.fillText("View Profi",23,87);a.fillText("Lap:"+b.lap,132,87)}});d={type:"f",value:0};var c={type:"f",value:100},k={type:"f",value:.6},q={fillPercent:d,color:{type:"c",value:new THREE.Color(13421772)},
opacity:{type:"f",value:1},gradientLength:c,gradientStartOpacity:k},s=[{fillPercent:d,color:{type:"c",value:new THREE.Color(TYPES[0].color)},opacity:{type:"f",value:1},gradientLength:c,gradientStartOpacity:k},{fillPercent:d,color:{type:"c",value:new THREE.Color(TYPES[1].color)},opacity:{type:"f",value:1},gradientLength:c,gradientStartOpacity:k}];w=new THREE.Object3D;n.add(w);dataApi.getTeamData(function(c){if(0!=c.status)console.error("Data status invalid: "+c.message,c);else for(var d=c.data.teams.length,
g=400/d,k=[c.data.weibo_total,c.data.twitter_total],u=0;u<d;u++){var n=c.data.teams[u];n.teamSize=k[n.typeIndex];var l=0==u?400:Math.round(g*(d-u+.9*(Math.random()-.5))*100)/100,m=new THREE.PlaneGeometry(3,l,2,Math.ceil(.125*l));m.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));m.applyMatrix((new THREE.Matrix4).makeTranslation(3.4*u,0,-l/2));for(var t=0;t<m.vertices.length;t+=3){var p=m.vertices.length-t,h;h=t/m.vertices.length/15*l;var r=0;1>=h/5&&(r+=3*Math.sin(h/5*Math.PI));.8<=h/5&&
(r+=(h-4)*(h-4)/5);h=r;m.vertices[p-3].y=h;m.vertices[p-2].y=h;m.vertices[p-1].y=h}m.dynamic=!1;l={percent:{type:"f",value:[]}};t=m.vertices;h=l.percent.value;for(p=0;p<t.length/3;p++)r=100-p/(t.length/3-1)*100,h.push(r,r,r);p=new THREE.ShaderMaterial({uniforms:q,attributes:l,vertexShader:a,fragmentShader:b,side:THREE.DoubleSide,transparent:!0});l=[new THREE.ShaderMaterial({uniforms:s[0],attributes:l,vertexShader:a,fragmentShader:b,side:THREE.DoubleSide,transparent:!0}),new THREE.ShaderMaterial({uniforms:s[1],
attributes:l,vertexShader:a,fragmentShader:b,side:THREE.DoubleSide,transparent:!0})];stick=new THREE.Mesh(m,p);stick.frustumCulled=!1;stick.matrixAutoUpdate=!1;stick.updateMatrix();stick.userData=n;stick.normalMaterial=p;stick.selectedMaterial=l[n.typeIndex];w.add(stick);z=3.4*d}f.position.set(0,35,43.8);f.lookAt(new THREE.Vector3(0,0,-400/3));f.position.setX(15);window.addEventListener("resize",G,!1);document.addEventListener("mousemove",H,!1);B();A&&A()})})()}})}})})()};
